/*
 * jQuery tableSelect plugin 1.0.0
 *
 * Copyright (c) 2010 Kjel Delaey
 *
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
*/

(function(a){a.extend(a.fn,{tableSelect:function(b){tableSelector=new a.tableSelector(b,this);return tableSelector}});a.extend(a.fn,{tableSelectOne:function(b){var b=a.extend({keepSelections:false},b);tableSelector=new a.tableSelector(b,this);return tableSelector}});a.extend(a.fn,{tableSelectMany:function(b){var b=a.extend({keepSelections:true},b);tableSelector=new a.tableSelector(b,this);return tableSelector}});a.tableSelector=function(b,c){this.options=a.extend({},a.tableSelector.defaults,b);this.currentTable=c;this.init()};a.extend(a.tableSelector,{defaults:{tableClass:"tableselect",rowSelectClass:"selected",keepSelections:false},prototype:{init:function(){this.selections=[];this.collectRows();this.initRowEvents();a(this.currentTable).addClass(this.options.tableClass)},lastActive:function(){return this.rows[this.lastActiveRow]},allSelected:function(){return(this.selections.length==this.rows.length)},selectedRows:function(){return this.selections},collectRows:function(){var b=this;this.rows=this.currentTable[0].tBodies[0].rows;a(this.rows).each(function(){this.parentThis=b})},initRowEvents:function(){var b=this;a(this.rows).each(function(){a(this).bind("click",b.handleMouseDown);a(this).bind("rowselect",b.rowSelectClass);a(this).bind("rowdeselect",b.rowSelectClass)})},handleMouseDown:function(c){var b=this.parentThis;var d=this.rowIndex-1;if(b.isSelected(this)==false){b.selectRow(d,b.options.keepSelections)}else{b.deselectRow(d,b.options.keepSelections)}},selectRow:function(d,c){var b=this.rows[d];if(c==false){this.clearSelections()}if(b&&this.isSelected(b)==false){this.selections.push(b);this.focusRow(d);a(b).trigger("rowselect");a(document).trigger("rowchange",this)}},deselectRow:function(d){var c=this.rows[d];if(c&&this.isSelected(c)){var b=a.inArray(c,this.selections);if(-1!=b){this.selections.splice(b,1);this.focusRow(d);a(c).trigger("rowdeselect");a(document).trigger("rowchange",this)}}},isSelected:function(d){var b=false;for(var c=0;c<this.selections.length;c++){if(this.selections[c]==d){b=true;break}}return b},focusRow:function(b){this.lastActiveRow=b},rowSelectClass:function(b){switch(b.type){case"rowselect":a(this).addClass(this.parentThis.options.rowSelectClass);break;case"rowdeselect":a(this).removeClass(this.parentThis.options.rowSelectClass);break;default:break}},selectAll:function(){if(this.options.keepSelections){this.clearSelections();a(this.rows).each(function(){this.parentThis.selectRow(this.rowIndex-1,this.parentThis.options.keepSelections)})}},clearSelections:function(){a(this.rows).each(function(){this.parentThis.deselectRow(this.rowIndex-1)})},selectRange:function(d,c,e){if(e==false){this.clearSelections()}if(d<=c){for(var b=d;b<=c;b++){this.selectRow(b,true)}}else{for(var b=d;b>=c;b--){this.selectRow(b,true)}}}}})})(jQuery);